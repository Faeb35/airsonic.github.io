<nav>
  {% capture html %}

  {% assign childCount = '' %}
  {% assign entries = site.pages | sort: "path" %}
  {% for entry in entries %}
      {% capture slug    %}{{ entry.url | split: "/"   | last                       }}{% endcapture %}
      {% capture current %}{{ entry.url | remove: slug | remove: "//" | append: "/" }}{% endcapture %}

      {% if current == include.context %}
          {% capture childCount %}{{ childCount }}*{% endcapture %}
      {% endif %}

  {% endfor %}

  {% if childCount.size > 0 %}
  <ul>
      {% if include.context == "/" %}
          <li class="{% if page.url == "/" %}active{% endif %}">
              <a href="{{ site.baseurl }}/">{{ site.title }}</a>
          </li>
      {% endif %}

      {% assign entries = site.pages | sort: "path" %}
      {% for entry in entries %}
          {% capture slug    %}{{ entry.url | split: "/"   | last                       }}{% endcapture %}
          {% capture current %}{{ entry.url | remove: slug | remove: "//" | append: "/" }}{% endcapture %}

          {% if current == include.context %}
              <li class="{% if page.url == entry.url %}active{% endif %}">
                  {% capture subMenu %}{% include wiki-nav.html context=entry.url %}{% endcapture %}
                  {% if subMenu.size > 0 %}
                      <a href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a>
                  {% endif %}
                  {% unless subMenu.size > 0 %}
                      <a class="active" href="{{ site.baseurl }}{{ entry.url }}">{{ entry.title }}</a>
                  {% endunless %}
                  {{ subMenu }}
              </li>
          {% endif %}

      {% endfor %}
  </ul>
  {% endif %}
  {% endcapture %}{{ html | strip_newlines | replace:'    ','' | replace:'    ','' | replace:'  ',' ' }}
</nav>
